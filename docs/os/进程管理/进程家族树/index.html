<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=Linux内核><meta name=author content=mestarz><link href=https://mestarz.github.io/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/%E8%BF%9B%E7%A8%8B%E5%AE%B6%E6%97%8F%E6%A0%91/ rel=canonical><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-7.0.2"><title>进程家族树 - Linux内核</title><link rel=stylesheet href=../../assets/stylesheets/main.1655a90d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.7fa14f5b.min.css><meta name=theme-color content=#ffffff><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font-family:"Noto Sans";--md-code-font-family:"Source Code Pro"}</style><link rel=stylesheet href=../../static/css/extra.css></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=white data-md-color-accent=red> <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://mestarz.github.io/ title=Linux内核 class="md-header__button md-logo" aria-label=Linux内核> <img src=../../static/img/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Linux内核 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 进程家族树 </span> </div> </div> </div> <div class=md-header__options> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/mestarz/mestarz-os/ title="前往 GitHub 仓库" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> mestarz/mestarz-os </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 介绍 </a> </li> <li class=md-tabs__item> <a href=../../%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95/%E7%BC%96%E8%AF%91%E5%86%85%E6%A0%B8/ class=md-tabs__link> 内核调试 </a> </li> <li class=md-tabs__item> <a href=../%E8%BF%9B%E7%A8%8B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/ class="md-tabs__link md-tabs__link--active"> 进程管理 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://mestarz.github.io/ title=Linux内核 class="md-nav__button md-logo" aria-label=Linux内核> <img src=../../static/img/logo.png alt=logo> </a> Linux内核 </label> <div class=md-nav__source> <a href=https://github.com/mestarz/mestarz-os/ title="前往 GitHub 仓库" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> mestarz/mestarz-os </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> 介绍 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=介绍 data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> 介绍 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Welcome to MkDocs </a> </li> <li class=md-nav__item> <a href=../../%E4%BB%8B%E7%BB%8D/%E5%86%85%E6%A0%B8%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D/ class=md-nav__link> 内核结构介绍 </a> </li> <li class=md-nav__item> <a href=../../%E4%BB%8B%E7%BB%8D/%E6%BA%90%E7%A0%81%E6%B5%8F%E8%A7%88%E6%96%B9%E6%B3%95/ class=md-nav__link> 源码浏览方法 </a> </li> <li class=md-nav__item> <a href=../../%E4%BB%8B%E7%BB%8D/%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D/ class=md-nav__link> 相关工具介绍 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> 内核调试 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=内核调试 data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 内核调试 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95/%E7%BC%96%E8%AF%91%E5%86%85%E6%A0%B8/ class=md-nav__link> 编译内核 </a> </li> <li class=md-nav__item> <a href=../../%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95/%E4%BD%BF%E7%94%A8QEMU%E8%BF%90%E8%A1%8C%E5%86%85%E6%A0%B8/ class=md-nav__link> 使用QEMU运行内核 </a> </li> <li class=md-nav__item> <a href=../../%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95/%E4%BD%BF%E7%94%A8GDB%E8%B0%83%E8%AF%95%E5%86%85%E6%A0%B8/ class=md-nav__link> 使用GDB调试内核 </a> </li> <li class=md-nav__item> <a href=../../%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95/%E4%BD%BF%E7%94%A8%E6%A0%91%E8%8E%93%E6%B4%BE%E8%BF%90%E8%A1%8C%E5%86%85%E6%A0%B8/ class=md-nav__link> 使用树莓派运行内核 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> 进程管理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=进程管理 data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 进程管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../%E8%BF%9B%E7%A8%8B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/ class=md-nav__link> 进程生命周期 </a> </li> <li class=md-nav__item> <a href=../%E8%BF%9B%E7%A8%8B%E6%8F%8F%E8%BF%B0%E7%AC%A6/ class=md-nav__link> 进程描述符 </a> </li> <li class=md-nav__item> <a href=../%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81/ class=md-nav__link> 进程状态 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> 进程家族树 </a> </li> <li class=md-nav__item> <a href=../%E8%BF%9B%E7%A8%8B%E5%88%9B%E5%BB%BA/ class=md-nav__link> 进程创建 </a> </li> <li class=md-nav__item> <a href=../%E8%BF%9B%E7%A8%8B%E7%BB%88%E6%AD%A2/ class=md-nav__link> 进程终止 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/mestarz/mestarz-os/edit/master/docs/进程管理/进程家族树.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>进程家族树</h1> <p>Linux系统中，所有进程都是PID为1的init进程的后代。内核在系统启动的最后阶段启动init进程。该进程读取系统的初始化脚本（initscript）并执行其他的相关程序，最终完成系统启动的整个过程。</p> <p>即每个进程都可以通过以下代码获取到init进程：</p> <div class=highlight><pre><span></span><code><span class=k>struct</span> <span class=nc>task_struct</span> <span class=o>*</span><span class=n>task</span><span class=p>;</span>
<span class=k>for</span><span class=p>(</span><span class=n>task</span> <span class=o>=</span> <span class=n>current</span><span class=p>;</span> <span class=n>task</span> <span class=o>!=</span> <span class=o>&amp;</span><span class=n>init_task</span><span class=p>;</span> <span class=n>task</span> <span class=o>=</span> <span class=n>task</span><span class=o>-&gt;</span><span class=n>parent</span><span class=p>);</span>
<span class=cm>/*task现在指向init*/</span>
</code></pre></div> <p>系统中的每个进程必有一个父进程，相应的，每个进程也可以拥有零个或多个子进程。拥有同一个父进程的所有进程被称为兄弟。进程间的关系存放在进程描述符中。每个task_struct都包含一个指向其父进程tast_struct、叫做parent的指针，还包含一个称为children的子进程链表。对于当前进程，可以通过以下操作获取其父进程的进程描述符：</p> <div class=highlight><pre><span></span><code><span class=k>struct</span> <span class=nc>task_struct</span> <span class=o>*</span><span class=n>my_parent</span> <span class=o>=</span> <span class=n>current</span><span class=o>-&gt;</span><span class=n>parent</span><span class=p>;</span>
</code></pre></div> <p>同时也可以按照以下方法访问子进程：</p> <div class=highlight><pre><span></span><code><span class=k>struct</span> <span class=nc>task_struct</span> <span class=o>*</span><span class=n>task</span><span class=p>;</span>
<span class=k>struct</span> <span class=nc>list_head</span> <span class=o>*</span><span class=n>list</span><span class=p>;</span>

<span class=n>list_for_each</span><span class=p>(</span><span class=n>list</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>current</span><span class=o>-&gt;</span><span class=n>children</span><span class=p>){</span>
    <span class=n>task</span> <span class=o>=</span> <span class=n>list_entry</span><span class=p>(</span><span class=n>list</span><span class=p>,</span> <span class=k>struct</span> <span class=nc>task_struct</span><span class=p>,</span> <span class=n>sibling</span><span class=p>);</span>
  <span class=cm>/* task 现在指向当前的某个子进程 */</span>
<span class=p>}</span>
</code></pre></div> <p><code>list_for_each</code> 是linux源码中的宏定义（./include/linux/list.h），其定义如下：</p> <div class=highlight><pre><span></span><code><span class=cp>#define list_for_each(pos, head) \</span>
<span class=cp>    for (pos = (head)-&gt;next; prefetch(pos-&gt;next), pos != (head); \</span>
<span class=cp>            pos = pos-&gt;next)</span>

<span class=cp>#define prefetch(x) __builtin_prefetch(x)  </span><span class=c1>//(./include/linux/prefetch.h)</span>
</code></pre></div> <p>因为任务队列是一个双向循环的链表，所以可以很容易的从一个进程遍历玩所有进程。</p> <p>对于给定的进程，获取链表中的下一个进程和上一个进程的代码如下：</p> <div class=highlight><pre><span></span><code><span class=n>list_entry</span><span class=p>(</span><span class=n>task</span><span class=o>-&gt;</span><span class=n>task</span><span class=p>.</span><span class=n>next</span><span class=p>,</span> <span class=k>struct</span> <span class=nc>task_struct</span><span class=p>,</span> <span class=n>tasks</span><span class=p>)</span>  <span class=c1>//获取下一个进程</span>

<span class=n>list_entry</span><span class=p>(</span><span class=n>task</span><span class=o>-&gt;</span><span class=n>task</span><span class=p>.</span><span class=n>prev</span><span class=p>,</span> <span class=k>struct</span> <span class=nc>task_struct</span><span class=p>,</span> <span class=n>tasks</span><span class=p>)</span>  <span class=c1>//获取上一个进程</span>
</code></pre></div> <p>以上代码通过next_task(task)宏和prev_task(task)宏定义了。</p> <p>其中list_entry是一个通过结构体内部的list成员变量获取结构体指针的神奇宏定义，其内容如下：</p> <div class=highlight><pre><span></span><code><span class=c1>// ./include/linux/list.h</span>
<span class=cm>/**</span>
<span class=cm> * list_entry - get the struct for this entry</span>
<span class=cm> * @ptr:    the &amp;struct list_head pointer.</span>
<span class=cm> * @type:   the type of the struct this is embedded in.</span>
<span class=cm> * @member: the name of the list_struct within the struct.</span>
<span class=cm> */</span>
<span class=cp>#define list_entry(ptr, type, member) \</span>
<span class=cp>    container_of(ptr, type, member)</span>


<span class=c1>// ./include/linux/kernel.h</span>
<span class=cm>/**</span>
<span class=cm> * container_of - cast a member of a structure out to the containing structure</span>
<span class=cm> * @ptr:    the pointer to the member.</span>
<span class=cm> * @type:   the type of the container struct this is embedded in.</span>
<span class=cm> * @member: the name of the member within the struct.</span>
<span class=cm> *</span>
<span class=cm> */</span>
<span class=cp>#define container_of(ptr, type, member) ({          \</span>
<span class=cp>    const typeof( ((type *)0)-&gt;member ) *__mptr = (ptr);    \</span>
<span class=cp>    (type *)( (char *)__mptr - offsetof(type,member) );})</span>
</code></pre></div> <p>同时，for_each_process(task)宏提供了依次访问整个任务队列的能力。每次访问，任务指针都指向链表中的下一个元素(./include/linux/sched.h)</p> <div class=highlight><pre><span></span><code><span class=cp>#define for_each_process(p) \</span>
<span class=cp>    for (p = &amp;init_task ; (p = next_task(p)) != &amp;init_task ; )</span>
</code></pre></div> <p>__builtin_prefetch() 是 gcc 的一个内置函数。它通过对数据手工预取的方法，减少了读取延迟，从而提高了性能，但该函数也需要 CPU 的支持。</p> <p>该函数原型为：</p> <div class=highlight><pre><span></span><code><span class=kt>void</span> <span class=n>__builtin_prefetch</span><span class=p>(</span><span class=k>const</span> <span class=kt>void</span> <span class=o>*</span><span class=n>addr</span><span class=p>,</span> <span class=p>...)</span>
</code></pre></div> <p>其中参数 addr 是个内存指针，它指向要预取的数据，我们人工需要判定这些数据是很快能访问到的，或者说是它们就在最近的内存中 --- 一般来说，对于链表而言，各个节点在内存中基本上是紧挨着的，所以我们容易预取链表节点里的指针项。</p> <p>该函数还有两个可选参数，rw 和 locality 。</p> <p>rw 是个编译时的常数，或 1 或 0 。1 时表示写(w)，0 时表示读&reg; 。</p> <p>locality 必须是编译时的常数，也称为“时间局部性”(temporal locality) 。时间局部性是指，如果程序中某一条指令一旦执行，则不久之后该指令可能再被执行；如果某数据被访问，则不久之后该数据会被再次访问。该值的范围在 0 - 3 之间。为 0 时表示，它没有时间局部性，也就是说，要访问的数据或地址被访问之后的不长的时间里不会再被访问；为 3 时表示，被访问的数据或地址具有高 时间局部性，也就是说，在被访问不久之后非常有可能再次访问；对于值 1 和 2，则分别表示具有低 时间局部性 和中等 时间局部性。该值默认为 3 。</p> <p>采用如下代码进行测试，使用O0优化进行编译，使用linux下使用time命令查看程序的执行时间：</p> <div class=highlight><pre><span></span><code><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp></span>


<span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=n>arg</span><span class=p>)</span>
<span class=p>{</span>
  <span class=kt>int</span> <span class=n>a</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>10</span><span class=p>};</span>
  <span class=kt>int</span> <span class=n>b</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>10</span><span class=p>};</span>
  <span class=kt>int</span> <span class=n>temp</span><span class=p>;</span>
  <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>;</span>
  <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=mi>100000000</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
  <span class=p>{</span>
    <span class=k>for</span><span class=p>(</span><span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>j</span><span class=o>&lt;</span><span class=mi>10</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
    <span class=p>{</span>
      <span class=c1>//进行一定次数的操作</span>
      <span class=n>a</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>+</span> <span class=n>b</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
      <span class=n>a</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>+</span> <span class=n>b</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
      <span class=n>a</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>+</span> <span class=n>b</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
      <span class=c1>//...</span>

      <span class=c1>//预获取命令</span>
      <span class=n>__builtin_prefetch</span><span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>[</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
      <span class=n>__builtin_prefetch</span><span class=p>(</span><span class=o>&amp;</span><span class=n>b</span><span class=p>[</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
    <span class=p>}</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>以下是在vbox的ubuntu虚拟机中实验获取的数据：</p> <table> <thead> <tr> <th>次数</th> <th>有预获取</th> <th>无预获取</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>5.257s</td> <td>4.643s</td> </tr> <tr> <td>2</td> <td>5.566s</td> <td>6.040s</td> </tr> <tr> <td>3</td> <td>6.152s</td> <td>6.401s</td> </tr> <tr> <td>4</td> <td>7.355s</td> <td>7.531s</td> </tr> <tr> <td>5</td> <td>8.890s</td> <td>10.233s</td> </tr> <tr> <td>6</td> <td>10.122s</td> <td>10.130s</td> </tr> <tr> <td>7</td> <td>12.342s</td> <td>12.368s</td> </tr> <tr> <td>8</td> <td>13.360s</td> <td>12.554s</td> </tr> </tbody> </table> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81/ class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> 进程状态 </div> </div> </a> <a href=../%E8%BF%9B%E7%A8%8B%E5%88%9B%E5%BB%BA/ class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> 进程创建 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020-2021 mestarz </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.f5903571.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.3981fc68.min.js></script> <script src=https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js></script> <script src=../../static/js/extra.js></script> <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>